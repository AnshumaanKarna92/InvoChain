# InvoChain - System Architecture

## ğŸ—ï¸ High-Level Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         USER INTERFACE                          â”‚
â”‚                     http://localhost:5173                       â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚Dashboard â”‚  â”‚ Invoices â”‚  â”‚   GST    â”‚  â”‚Reconciliationâ”‚  â”‚
â”‚  â”‚          â”‚  â”‚          â”‚  â”‚ Returns  â”‚  â”‚              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                 â”‚
â”‚             React + Vite + TailwindCSS + Dark Mode             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â”‚ REST API (HTTPS)
                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         API GATEWAY                             â”‚
â”‚                      http://localhost:3000                      â”‚
â”‚                                                                 â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚    â”‚  Request Routing  â”‚  CORS  â”‚  Rate Limiting â”‚... â”‚        â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                      â”‚                      â”‚
        â–¼                      â–¼                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     AUTH     â”‚    â”‚   INVOICE    â”‚    â”‚   MERCHANT       â”‚
â”‚   SERVICE    â”‚    â”‚   SERVICE    â”‚    â”‚   REGISTRY       â”‚
â”‚  Port: 3011  â”‚    â”‚  Port: 3002  â”‚    â”‚   Port: 3012     â”‚
â”‚              â”‚    â”‚              â”‚    â”‚                  â”‚
â”‚ - Register   â”‚    â”‚ - Create     â”‚    â”‚ - Profile Mgmt   â”‚
â”‚ - Login      â”‚    â”‚ - Accept/    â”‚    â”‚ - GSTIN Verify   â”‚
â”‚ - JWT Auth   â”‚    â”‚   Reject     â”‚    â”‚ - Onboarding     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                   â”‚                     â”‚
        â”‚                   â–¼                     â”‚
        â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
        â”‚          â”‚  INVENTORY   â”‚               â”‚
        â”‚          â”‚   SERVICE    â”‚               â”‚
        â”‚          â”‚ Port: 3013   â”‚               â”‚
        â”‚          â”‚              â”‚               â”‚
        â”‚          â”‚ - Reserve    â”‚               â”‚
        â”‚          â”‚ - Commit     â”‚               â”‚
        â”‚          â”‚ - Release    â”‚               â”‚
        â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
        â”‚                   â”‚                     â”‚
        â–¼                   â–¼                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  POSTGRESQL DATABASE                    â”‚
â”‚                   Port: 5433/5432                       â”‚
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚  users   â”‚  â”‚merchants â”‚  â”‚ invoices â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚inventory â”‚  â”‚ payments â”‚  â”‚gst_returnsâ”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â–²                   â–²                     â–²
        â”‚                   â”‚                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  GST RETURN  â”‚    â”‚   PAYMENT    â”‚    â”‚RECONCILIATIONâ”‚
â”‚   SERVICE    â”‚    â”‚   SERVICE    â”‚    â”‚   SERVICE    â”‚
â”‚  Port: 3008  â”‚    â”‚  Port: 3010  â”‚    â”‚  Port: 3006  â”‚
â”‚              â”‚    â”‚              â”‚    â”‚              â”‚
â”‚ - GSTR-1     â”‚    â”‚ - Record     â”‚    â”‚ - Run Recon  â”‚
â”‚ - GSTR-3B    â”‚    â”‚ - Analytics  â”‚    â”‚ - Find Disc  â”‚
â”‚ - File       â”‚    â”‚ - Methods    â”‚    â”‚ - Resolve    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                   â”‚                     â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â–¼                       â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚    AUDIT     â”‚        â”‚  BLOCKCHAIN  â”‚
        â”‚   SERVICE    â”‚        â”‚   SERVICE    â”‚
        â”‚ Port: 3014   â”‚        â”‚  Port: 3003  â”‚
        â”‚              â”‚        â”‚              â”‚
        â”‚ - Log Events â”‚        â”‚ - Hash Chain â”‚
        â”‚ - Compliance â”‚        â”‚ - Immutable  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“Š Data Flow Diagrams

### Invoice Creation Flow

```
User Browser
     â”‚
     â”‚ 1. POST /api/invoices { items, buyer_gstin, ... }
     â–¼
API Gateway (3000)
     â”‚
     â”‚ 2. Forward request
     â–¼
Invoice Service (3002)
     â”‚
     â”‚ 3. Validate data
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚                             â”‚
     â”‚ 4. Reserve Stock            â”‚ 6. Create Invoice
     â–¼                             â–¼
Inventory Service (3013)      PostgreSQL DB
     â”‚                             â”‚
     â”‚ 5. Create/Update            â”‚ 7. Insert invoice
     â”‚    Inventory Items          â”‚    & invoice_items
     â–¼                             â–¼
PostgreSQL DB â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â””â”€â–º Success Response
     â”‚
     â”‚ 8. Log Event
     â–¼
Audit Service (3014)
     â”‚
     â–¼
PostgreSQL DB (audit_logs)
```

### GST Return Generation Flow

```
User Browser
     â”‚
     â”‚ 1. POST /api/gst/generate/gstr1 { merchant_id, period }
     â–¼
API Gateway (3000)
     â”‚
     â”‚ 2. Forward request
     â–¼
GST Return Service (3008)
     â”‚
     â”œâ”€â–º 3. Fetch Merchant GSTIN
     â”‚   from PostgreSQL (merchants)
     â”‚
     â”œâ”€â–º 4. Fetch Invoices for merchant
     â”‚   from PostgreSQL (invoices)
     â”‚
     â”œâ”€â–º 5. Fetch Credit/Debit Notes
     â”‚   from PostgreSQL (notes)
     â”‚
     â”‚ 6. Calculate GSTR-1 data:
     â”‚    - B2B Invoices
     â”‚    - CGST, SGST, IGST totals
     â”‚    - Summary calculations
     â”‚
     â”‚ 7. Save return to DB
     â”‚   (gst_returns table)
     â–¼
PostgreSQL DB
     â”‚
     â”‚ 8. Return generated GST data
     â–¼
User Browser (View JSON)
```

### Inventory Management Flow

```
                    Invoice Created
                           â”‚
                           â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚   Inventory Service      â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                 â”‚                 â”‚
         â–¼                 â–¼                 â–¼
    Item Exists?      AUTO-SEED        RESERVE Stock
         â”‚               NEW             â”‚
         â”‚              ITEM          quantity: 100
         â”‚                 â”‚          reserved: 10
         â”‚                 â”‚          available: 90
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
                  â”‚                          â”‚
                  â–¼                          â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚        INVENTORY_EVENTS Table         â”‚
          â”‚  - event_type: RESERVE                â”‚
          â”‚  - quantity_change: +10 (reserved)    â”‚
          â”‚  - actor: invoice_service             â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                  â”‚                  â”‚
        â–¼                  â–¼                  â–¼
    ACCEPTED          REJECTED           EXPIRED
        â”‚                  â”‚                  â”‚
    COMMIT            RELEASE            RELEASE
    Stock             Reserved           Reserved
        â”‚              Stock              Stock
        â–¼                  â–¼                  â–¼
   quantity: 90      quantity: 100     quantity: 100
   reserved: 0       reserved: 0       reserved: 0
   available: 90     available: 100    available: 100
```

## ğŸ—„ï¸ Database Schema Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      AUTHENTICATION                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  users                                                      â”‚
â”‚  â”œâ”€â”€ id (UUID, PK)                                          â”‚
â”‚  â”œâ”€â”€ email (UNIQUE)                                         â”‚
â”‚  â”œâ”€â”€ password_hash                                          â”‚
â”‚  â””â”€â”€ role                                                   â”‚
â”‚                                                              â”‚
â”‚  merchants                                                  â”‚
â”‚  â”œâ”€â”€ id (UUID, PK)                                          â”‚
â”‚  â”œâ”€â”€ user_id (FK â†’ users.id)                               â”‚
â”‚  â”œâ”€â”€ gstin (UNIQUE)                                         â”‚
â”‚  â”œâ”€â”€ legal_name                                             â”‚
â”‚  â”œâ”€â”€ address                                                â”‚
â”‚  â””â”€â”€ phone                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         INVOICING                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  invoices                                                   â”‚
â”‚  â”œâ”€â”€ id (UUID, PK)                                          â”‚
â”‚  â”œâ”€â”€ invoice_number (UNIQUE)                                â”‚
â”‚  â”œâ”€â”€ seller_merchant_id (FK â†’ merchants.id)                â”‚
â”‚  â”œâ”€â”€ buyer_gstin                                            â”‚
â”‚  â”œâ”€â”€ total_amount                                           â”‚
â”‚  â”œâ”€â”€ tax_amount                                             â”‚
â”‚  â”œâ”€â”€ status (ISSUED/ACCEPTED/REJECTED)                     â”‚
â”‚  â””â”€â”€ created_at                                             â”‚
â”‚                                                              â”‚
â”‚  invoice_items                                              â”‚
â”‚  â”œâ”€â”€ id (UUID, PK)                                          â”‚
â”‚  â”œâ”€â”€ invoice_id (FK â†’ invoices.id)                         â”‚
â”‚  â”œâ”€â”€ sku                                                    â”‚
â”‚  â”œâ”€â”€ quantity                                               â”‚
â”‚  â””â”€â”€ unit_price                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       INVENTORY                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  inventory                                                  â”‚
â”‚  â”œâ”€â”€ id (UUID, PK)                                          â”‚
â”‚  â”œâ”€â”€ merchant_id (FK â†’ merchants.id)                       â”‚
â”‚  â”œâ”€â”€ sku (UNIQUE per merchant)                             â”‚
â”‚  â”œâ”€â”€ quantity                                               â”‚
â”‚  â”œâ”€â”€ reserved_quantity                                      â”‚
â”‚  â””â”€â”€ unit_price                                             â”‚
â”‚                                                              â”‚
â”‚  inventory_events                                           â”‚
â”‚  â”œâ”€â”€ id (UUID, PK)                                          â”‚
â”‚  â”œâ”€â”€ inventory_id (FK â†’ inventory.id)                      â”‚
â”‚  â”œâ”€â”€ event_type (RESERVE/COMMIT/RELEASE)                   â”‚
â”‚  â”œâ”€â”€ quantity_change                                        â”‚
â”‚  â””â”€â”€ actor                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      GST & COMPLIANCE                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  gst_returns                                                â”‚
â”‚  â”œâ”€â”€ id (UUID, PK)                                          â”‚
â”‚  â”œâ”€â”€ merchant_id (FK â†’ merchants.id)                       â”‚
â”‚  â”œâ”€â”€ return_type (GSTR1/GSTR3B)                            â”‚
â”‚  â”œâ”€â”€ period_month                                           â”‚
â”‚  â”œâ”€â”€ period_year                                            â”‚
â”‚  â”œâ”€â”€ gstin                                                  â”‚
â”‚  â”œâ”€â”€ return_data (JSONB)                                    â”‚
â”‚  â”œâ”€â”€ status (DRAFT/FILED)                                  â”‚
â”‚  â””â”€â”€ filed_at                                               â”‚
â”‚                                                              â”‚
â”‚  e_invoices (for future IRN integration)                   â”‚
â”‚  â”œâ”€â”€ id (UUID, PK)                                          â”‚
â”‚  â”œâ”€â”€ invoice_id (FK â†’ invoices.id)                         â”‚
â”‚  â”œâ”€â”€ irn (UNIQUE)                                           â”‚
â”‚  â””â”€â”€ status                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  PAYMENTS & RECONCILIATION                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  payments                                                   â”‚
â”‚  â”œâ”€â”€ id (UUID, PK)                                          â”‚
â”‚  â”œâ”€â”€ invoice_id (FK â†’ invoices.id)                         â”‚
â”‚  â”œâ”€â”€ amount                                                 â”‚
â”‚  â”œâ”€â”€ method (BANK/UPI/CASH/CHEQUE)                         â”‚
â”‚  â””â”€â”€ payment_date                                           â”‚
â”‚                                                              â”‚
â”‚  reconciliation_reports                                     â”‚
â”‚  â”œâ”€â”€ id (UUID, PK)                                          â”‚
â”‚  â”œâ”€â”€ total_invoices                                         â”‚
â”‚  â”œâ”€â”€ matched_invoices                                       â”‚
â”‚  â””â”€â”€ discrepancies_count                                    â”‚
â”‚                                                              â”‚
â”‚  discrepancies                                              â”‚
â”‚  â”œâ”€â”€ id (UUID, PK)                                          â”‚
â”‚  â”œâ”€â”€ report_id (FK â†’ reconciliation_reports.id)           â”‚
â”‚  â”œâ”€â”€ invoice_id                                             â”‚
â”‚  â”œâ”€â”€ type (MISSING_BUYER/REJECTED_INVOICE)                 â”‚
â”‚  â””â”€â”€ status (OPEN/RESOLVED)                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”„ Service Communication

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Service Dependencies                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Invoice Service
    â”œâ”€â–º Calls: Inventory Service (Reserve Stock)
    â”œâ”€â–º Calls: Merchant Registry (Validate GSTIN)
    â”œâ”€â–º Calls: Audit Service (Log Events)
    â””â”€â–º Database: invoices, invoice_items

Inventory Service
    â”œâ”€â–º Database: inventory, inventory_events
    â””â”€â–º Independent (no outbound calls)

GST Return Service
    â”œâ”€â–º Database: gst_returns, invoices, notes, merchants
    â””â”€â–º Independent (no outbound calls)

Payment Service
    â”œâ”€â–º Database: payments, invoices
    â””â”€â–º Independent (no outbound calls)

Reconciliation Service
    â”œâ”€â–º Database: reconciliation_reports, discrepancies, invoices
    â””â”€â–º Independent (no outbound calls)

All Services â†’ PostgreSQL (Shared Database)
```

## ğŸ” Security Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Security Layers                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Layer 1: Network Security
    â”œâ”€â–º HTTPS/SSL (in production)
    â”œâ”€â–º CORS Configuration
    â””â”€â–º Rate Limiting (optional)

Layer 2: Authentication
    â”œâ”€â–º JWT Tokens
    â”œâ”€â–º Password Hashing (bcrypt ready)
    â””â”€â–º Session Management

Layer 3: Authorization
    â”œâ”€â–º Role-Based Access Control (RBAC)
    â”œâ”€â–º Merchant-specific data filtering
    â””â”€â–º Resource ownership validation

Layer 4: Data Security
    â”œâ”€â–º SQL Injection Prevention (Parameterized Queries)
    â”œâ”€â–º XSS Protection
    â”œâ”€â–º Input Validation
    â””â”€â–º Output Sanitization

Layer 5: Application Security
    â”œâ”€â–º Helmet.js Security Headers
    â”œâ”€â–º Environment Variable Protection
    â””â”€â–º Secret Management
```

## ğŸ“ˆ Scalability Design

```
                    Load Balancer (Nginx)
                            â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                   â”‚                   â”‚
        â–¼                   â–¼                   â–¼
   API Gateway         API Gateway         API Gateway
   (Instance 1)        (Instance 2)        (Instance 3)
        â”‚                   â”‚                   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                   â”‚                   â”‚
    Service               Service             Service
    Instances             Instances           Instances
    (Clustered)           (Clustered)         (Clustered)
        â”‚                   â”‚                   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                   PostgreSQL Primary
                            â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚               â”‚
               Read Replica    Read Replica
               (Optional)      (Optional)
```

---

**Architecture Version**: 1.0.0  
**Last Updated**: November 2025  
**Status**: Production Ready
